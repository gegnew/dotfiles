" vim: filetype=vim

" This wipes all existing settings. This means that if a setting in this file
" is removed, then it will return to default. In other words, this file serves
" as an enforced single point of truth for Tridactyl's configuration.
sanitize tridactyllocal tridactylsync

colors base16-nord

" Just use a blank page for new tab. It would be nicer to use the standard
" Firefox homepage, but Tridactyl doesn't support this yet.
set newtab about:blank

" set editorcmd to alacritty terminal, or use the defaults on other platforms
js tri.browserBg.runtime.getPlatformInfo().then(os=>{const editorcmd = os.os=="linux" ? "alacritty nvim" : "auto"; tri.config.set("editorcmd", editorcmd)})
" or just do
" set editorcmd /usr/local/bin/st -e /usr/bin/nvim

" GitHub pull request checkout command to clipboard (only works if you're a collaborator or above)
bind yp composite js document.getElementById("clone-help-step-1").textContent.replace("git checkout -b", "git checkout -B").replace("git pull ", "git fetch ") + "git reset --hard " + document.getElementById("clone-help-step-1").textContent.split(" ")[3].replace("-","/") | yank

" Git{Hub,Lab} git clone via SSH yank
bind yg composite js "git clone " + document.location.href.replace(/https?:\/\//,"git@").replace("/",":").replace(/$/,".git") | clipboard yank

" As above but execute it and open terminal in folder
bind ,g js let uri = document.location.href.replace(/https?:\/\//,"git@").replace("/",":").replace(/$/,".git"); tri.native.run("cd ~/projects; git clone " + uri + "; cd \"$(basename \"" + uri + "\" .git)\"; st")

" make d take you to the tab you were just on (I find it much less confusing)
bind x composite tab #; tabclose #
unbind d

" Only hint search results on Google and DDG
" bindurl www.google.com f hint -Jc .rc > .r > a
" bindurl www.google.com F hint -Jbc .rc>.r>a

" bindurl ^https://duckduckgo.com f hint -Jc [class=result__a]
" bindurl ^https://duckduckgo.com F hint -Jbc [class=result__a]

" Make yy use canonical / short links on the 5 websites that support them
bind yy clipboard yankcanon

" But also support Tridactyl search too.
bind / fillcmdline find
bind ? fillcmdline find -?
bind n findnext 1
bind N findnext -1
bind ,<Space> nohlsearch
" Use sensitive case. Smart case would be nice here, but it doesn't work.
" set findcase sensitive

" Smooth scrolling, yes please. This is still a bit janky in Tridactyl.
set smoothscroll true

" The default jump of 10 is a bit much.
bind j scrollline 5
bind k scrollline -5

" Don't run Tridactyl on some web sites because it doesn't work well, or
" because the web site has its own keybindings.
" autocmd DocStart mail.google.com mode ignore

" Sometimes the status bar in the bottom left corner overlaps the Tridactyl
" command line, so set an option to move the status bar to the right.
guiset_quiet hoverlink right

set hintchars fdsqjklmrezauiopwxcvghtybn

bind ZZ !s killall firefox
" hint mode for HackerNews
bind ;c hint -c [class*="expand"],[class="togg"]
" detach tabs for multitasking
bind gd tabdetach
bind gD composite tabduplicate; tabdetach

" Map keys to keys with the native messenger installed and xdotool
bind --mode=insert <C-j> !s xdotool key Down
bind --mode=insert <C-k> !s xdotool key Up

" Inject Google Translate
" This (clearly) is remotely hosted code. Google will be sent the whole
" contents of the page you are on if you run `:translate`
" From https://github.com/jeremiahlee/page-translator
command translate js let googleTranslateCallback = document.createElement('script'); googleTranslateCallback.innerHTML = "function googleTranslateElementInit(){ new google.translate.TranslateElement(); }"; document.body.insertBefore(googleTranslateCallback, document.body.firstChild); let googleTranslateScript = document.createElement('script'); googleTranslateScript.charset="UTF-8"; googleTranslateScript.src = "https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit&tl=&sl=&hl="; document.body.insertBefore(googleTranslateScript, document.body.firstChild);
